# 第一章 计算机系统漫游

计算机系统是由硬件和系统软件组成的，他们共同工作来运行应用程序。

---
##1.1 信息就是位+上下文

程序的生命周期是从一个**源程序**(或者说**源文件**)开始的，即程序员通过编辑器创建并保存的文本文件。源程序实际上就是一个由值0和1组成的位(又称为比特)序列，8个位被组织成一组，称为**字节**。

程序的基本思想：系统中所有的信息———包括磁盘文件、内存中的程序、内存中存放的用户数据以及网络上传送的数据，都是由一串比特表示的。区分不同数据对象的唯一方法就是我们读到这些数据对象时的上下文。

---
##1.2 程序被其他程序翻译成不同的格式
**预处理器**、**编译器**、**汇编器**和**链接器**一起构成了**编译系统**

在linux上面，从原文件到目标文件的转化是由**编译器驱动程序**完成的:
```
gcc -o hello hello.c
```
**预处理阶段**

预处理器(cpp)根据以字符#开头的命令，修改原始的C程序，将该文件直接插入程序文本中，通常是以.i作为文件拓展名。

**编译阶段**

编译器(ccl)将文本文件.i翻译成文本文件.s，里面包含了一个汇编语言程序。

**汇编阶段**

汇编器(as)将.s文件翻译成机器语言指令，将这些指令打包成一种叫做**可重定位目标程序**的格式，并将结果保存在目标以.o结尾的文件中。

**链接阶段**

如果程序当中使用了标准库中的函数，在标准库中的函数都有.o结尾的程序，链接器(ld)就负责处理将所有的.o文件合并。

以上四个阶段执行完毕后就可以得到程序文件，它是一个可执行目标文件，可以被加载到内存中，由系统执行

---
##1.3 了解编译系统如何工作是大有益处的

编译系统都做了哪些工作：**优化程序性能**、**理解链接时出现的错误**、**避免安全漏洞**

---
##1.4处理器读并解释储存在内存中的指令

###1.4.1系统的硬件组成

1.总线：贯穿整个系统的是一组电子管道，称作总线，它携带信息字节并负责在各个部件间传递，负责传动定长的字节快。(32位系统占4个字节，64位系统占8个字节)

2.I/O设备：I/O(输入/输出)设备是系统与外部世界的联系通道。

3.主存：主存是一个临时存储这杯，在处理器执行程序时，用来存放程序和程序处理的数据。

4.处理器：中央处理单元(CPU),简称处理器，是解释(或执行)存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备(或寄存器)，称为程序计数器(PC)。在任何时刻，PC都指向主存中的某条机器语言指令。

###1.4.2 运行程序

需要图片支持

---
##1.5 高速缓存至关重要

程序的机器指令最初存放在磁盘上，当程序加载时，它们被复制到主存；当处理器运行程序时，指令又从主存复制到处理器。这些复制都减慢了程序真正运行的时间。

解决方法：

1.高速缓存存储器(cache)，作为暂时的集结区域，存放处理器近期可能会需要的信息。

2.静态随机访问存储器硬件技术实现

---
##1.6 存储设备形成层次结构

从上到下设备的访问速度越来越慢，但是容量越来越大。

---
##1.7 操作系统管理硬件

操作系统有两个基本功能：

1.防止硬件被失控的应用程序滥用。

2.向应用程序提供简单一致的机制来控制负载而又通常大不相同的低级硬件设备。

###1.7.1 进程

**进程**是操作系统对一个正在运行的程序的一种抽象。一个系统可以同时运行多个进程，每个进程都好像独占的使用硬件而并发运行。

无论在单核还是多核系统中，一个CPU看上去都像是在并发地执行多个进程，这是通过处理器在进程间切换来实现的。操作系统实现这种交错执行的机制称为上下文切换。即保存当前进程的上下文，恢复新进程的上下文。

###1.7.2 线程

一个进程实际上可以由多个称为**线程**的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。

###1.7.3 虚拟内存

**虚拟内存**是一个抽象概念，它为每个进程提供一个假象，即每个进程偶在独占地使用主存。每个进程看到的内存都是一致的，成为虚拟地址空间。linux中，地址空间最上面的区域保留给操作系统中的代码和数据的
，地址空间的底部区域存放用户进程定义的代码和数据。

内存结构介绍:

`程序代码和数据`：对所有的进程来说，代码是从同意固定地址开始，紧接着的是C全局变量相对应的数据位置。

`堆`：代码和数据区后紧接着的是运行时堆。这里面的数据一般由程序员进行申请和释放。(可以动态地拓展和收缩，向上增长)

`共享库`：在地址空间的中间部分是一块要用来存放标准库和数学库这种共享库的代码和数据的区域。

`栈`：位于用户虚拟地址空间顶部的是用户栈，编译器用它来实现函数调用。此空间由程序自己释放空间内存。(可以动态地拓展和收缩，向下增长)

`内核虚拟内存`：地址空间顶部的区域是为内核保留的。不允许应用程序读写这个区域的内容或者直接调用内核代码定义的函数。

`文件`：文件就是字节序列，仅此而已，每个I/O设备，磁盘，键盘都可以看成是文件。

---
##1.8 系统之间利用网络通信

网络可以视为一个I/O设备，系统从主存复制一串字节到网络适配器，数据流经过网络到达另一台机器。

---
##1.9 重要主题

###1.9.1 Amdahi定律

该定律的主题思想是，当我们对系统分某个部分加速时，对其系统整体性能的影响取决于该部分的重要性和加速程度。

###1.9.2 并发和并行

**并发**是一个通用的概念，指一个同时具有多个活动的系统；**并行**指的是用并发来使一个系统运行得更快。

1.线程及并发：使用线程，在一个进程中执行多个控制流。

2.指令集并行：在较低的抽象层次上，同时执行多条指令的属性称为指令集并行。

3.单指令、多数据并行：在最低层次上，允许一条指令产生多个可以并行执行的操作。

###1.9.3 计算机系统中抽象的重要性

抽象是使用计算机科学中最为重要的概念之一。

文件是对I/O设备的抽象，虚拟内存是对程序存储器的抽象，进程是对一个正在运行的程序的抽象，虚拟机是对整个计算机的抽象。