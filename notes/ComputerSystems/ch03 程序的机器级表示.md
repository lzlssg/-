# 第一章 计算机系统漫游

计算机执行*机器代码*，用字节序列编码低级的操作，包括处理数据，管理内存，读写存储设备上的数据，以及利用网络通信。编译器基于编程语言的规则、目标机器的指令集和操作系统遵循的惯例，经历一系列的阶段生成
机器代码。GCC C语言编译器以及*汇编代码*的形式产生输出，汇编代码是机器代码的文本表示，给出程序中的每一条指令。然后GCC调用*汇编器和链接器*，根据汇编代码生成可执行的机器代码。

---
##3.2 程序编码

```
gcc -Og -o p1.c p2.c
```
编译选项-Og告诉编译器使用会生成符合原始C代码整体结构的机器代码优化等级。使用较高级别优化产生的代码会严重变形，以至于产生的机器代码和初始源代码之间的关系非常难以理解。

实际上gcc命令调用了一整套的程序，将源代码转化成可执行代码。
首先，C*预处理器*拓展源代码，插入所有用#include命令指定的文件，并拓展所有用#define声明指定的宏。
其次，*编译器*产生两个源文件的汇编代码，名字分别为p1.s和p2.s。
接下来，*汇编器*会将汇编代码转化成二进制*目标代码文件*文件p1.o和p2.o。
目标代码是机器代码的一种形式，它包含所有的指令的二进制表示，但是还没有填入全局值的地址。
最后，*链接器*将两个目标代码文件与实现库函数的代码合并，并产生最终的可执行文件p。

---
###3.2.1机器级代码

计算机系统使用了多种不同形式的抽象，利用更简单的抽象模型来隐藏实现的细节。对与机器级编程来说，其中两种抽象尤为重要。第一种是*指令集体系结构或指令集架构*来定义机器级程序的格式和行为，它定义了处理器
状态、指令的格式，以及每条指令对状态的影响。第二种抽象是，机器级程序使用的内存地址是虚拟地址，提供的内存模型看上去是一个非常大的字节数组。

一些通常对C语言程序员隐藏的处理器状态都是可见的：

1.*程序计数器*：给出将要执行的下一条指令在内存中的地址。

2.*整数寄存器文件*：包含16个命名位置，分别存储64位的值。这些寄存器可以存储地址或整数数据。有的寄存器被用来记录某些重要的程序状态，而其他的寄存器用来保存临时数据，例如过程的参数和局部变量，以及函数的
返回值。

3.条件码寄存器保存着最近执行的算术或逻辑指令的状态信息。他们用来实现控制或数据流中的条件变化，比如用来实现if和while语句

4.一组向量寄存器可以存放一个或多个整数或浮点数值。

---
##3.3 数据格式

术语"字(word)"表示16位数据类型，因为32位数位“双字”，64位数位“四字”。

浮点数主要有两种形式：单精度(4字节)值，对应于c语言数据类型float；双精度(8字节)值，对应于c语言数据类型double。

---
##3.4 访问信息

一个x86-64的中央处理单元(CPU)包含一组16个存储64位值的*通用目的寄存器*。这些寄存器用来存储整数数据和指针。16位操作可以访问最低的2个字节，32位操作可以访问最低的4个字节，而64位操作可以访问整个寄存器。

最特别的栈指针`%rsp`，用来指明运行时栈的结束位置。

---
###3.4.1 操作数指示符

大多数指令有一个或多个*操作数*，指示出执行一个操作中要使用的源数据值，以及放置结果的目的位置。各种不同的操作数的可能性被分为三种类型。第一种类型是立即数。第二种类型是寄存器，第三类操作数是内存引用。